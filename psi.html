<!DOCTYPE html>
<html>
  <head>
    <title>PSI â€¢ jczimm</title>
    <script src="http://code.jquery.com/jquery-1.11.0.js"></script>
    <link rel="stylesheet" href="pstyle.css">
    <script src="https://cdn.rawgit.com/jonobr1/two.js/master/build/two.js"></script>
  </head>
  <body onload="init();">
    <script>
      /*Array.prototype.remove = function(from, to) {
        var rest = this.slice((to || from) + 1 || this.length);
        this.length = from < 0 ? this.length + from : from;
        return this.push.apply(this, rest);
      };*/
      var two;
      var velY = posY = 0;
      var keydown, onGround = true;
      var props = {
        trashcan: "<img style=\"right:0px;bottom:0px\" src=\"http://fc02.deviantart.net/fs71/f/2014/088/2/5/trash_by_oceanscented-d7c6gzz.png\" class=\"prop can\" />",
        hook:     "<img style=\"right:0px;bottom:0px\" src=\"http://fc02.deviantart.net/fs71/f/2014/088/2/5/trash_by_oceanscented-d7c6gzz.png\" class=\"prop hook\" />"
      }, ticks = 0;
      function init(){
        two = new Two({
          fullscreen: true,
          autostart: true
        }).appendTo(document.getElementById("game-wrapper"));
        two.bind('update', function(){
          
          //makes obstacles
          if(Math.random()<0.01) $("#game-wrapper").append(randObstacle());
          if($(".prop").css("right")=="auto") $(".prop").css("right","0px");
          $(".prop").each(function(i,e){
            if(Number($(e).css("right").substr(0,$(e).css("right").length-2))<two.width)
              $(e).css("right",Number($(e).css("right").substr(0,$(e).css("right").length-2))+14+"px");
            else
              $(e).remove();
          });
          $(".prop").css("bottom",two.height*0.2+30);
          
          if(keydown && onGround) velY = 50, onGround = false;
          posY += velY;
          velY -= 0.3;
          velY = velY|0;
          $("#player").css("bottom",two.height*0.2+posY+"px");
          if(posY<0) posY = velY = 0, onGround = true;
            
          ticks++;
        });
        addKeyListeners();
      }
      
      function randObstacle(){
        return Math.random()<=0.6 ? $(props.trashcan) : $(props.hook);
      }
      
      function addKeyListeners(){
        $(document).keydown(function(e){
          if(e.keyCode==32) keydown = true;
        });
        $(document).keyup(function(e){
          if(e.keyCode==32) keydown = false;
        });
      }
      $(document).resize(function(){
        //two.width = $(window).width();
        two.height = $(window).height();
        $(".prop").css("bottom",two.height*0.2+30);
        $("#player").css("bottom",two.height*0.2+posY+"px");
      });
    </script>
    <div id="game-wrapper">
      <img src="http://files.gamebanana.com/img/ico/sprays/sasuke_2.gif" style="bottom:0px" id="player" />
      
    </div>
  </body>
</html>
